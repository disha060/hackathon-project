<!DOCTYPE html>

<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>AMEP Mastery Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24;
            font-size: 20px;
        }
        .progress-bar-glow-teal {
            box-shadow: 0 0 8px 0px #0df2df, 0 0 12px 0px #0df2df33;
        }
        .progress-bar-glow-blue {
            box-shadow: 0 0 8px 0px #00A9FF, 0 0 12px 0px #00A9FF33;
        }
        .progress-bar-glow-indigo {
            box-shadow: 0 0 8px 0px #4338CA, 0 0 12px 0px #4338CA33;
        }
        .frosted-glass {
            background-color: rgba(255, 255, 255, 0.05);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0df2df",
                        "background-light": "#f5f8f8",
                        "background-dark": "#101014",
                        "blue-medium": "#00A9FF",
                        "indigo-low": "#4338CA",
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-background-dark font-display text-white">
<div class="relative flex min-h-screen w-full flex-col">
<div class="layout-container flex h-full grow flex-col items-center px-4 sm:px-8 md:px-20 lg:px-40 py-5">
<div class="layout-content-container flex w-full max-w-[960px] flex-1 flex-col">
<!-- Header -->
        <header class="border-b border-indigo-500/20 backdrop-blur-sm bg-[#0F172A]/30">
            <div class="container mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="text-xl font-bold tracking-wide bg-gradient-to-r from-blue-500 via-indigo-500 to-teal-500 bg-clip-text text-transparent">
                        AMEP
                    </div>
                    <nav class="hidden md:flex space-x-6">
                        <a href="student-dashboard.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="dashboard">Dashboard</a>
                        <a href="mastery-tracker.html" class="text-white font-medium nav-link" data-page="mastery">Mastery Tracker</a>
                        <a href="assignments.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="assignments">Assignments</a>
                        <a href="projects.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="projects">Projects</a>
                        <a href="leaderboard.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="leaderboard">Leaderboard</a>
                        <a href="badges.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="badges">Badges</a>
                    </nav>
                    <div class="flex items-center space-x-4">
                        <button id="mobile-menu-toggle" class="md:hidden text-gray-400 hover:text-white focus:outline-none">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                        <span class="text-gray-300 hidden sm:inline" id="user-name">John Doe</span>
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center">
                            <span class="font-bold" id="user-initials">JD</span>
                        </div>
                        <a href="#" id="desktop-logout-btn" class="hidden md:block text-gray-300 hover:text-white transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </header>
<main class="flex flex-col gap-8 py-8 px-4 sm:px-0">
<div class="flex flex-wrap items-end justify-between gap-4">
<h1 class="text-white text-4xl font-black leading-tight tracking-[-0.033em] min-w-72">Mastery Tracker</h1>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
<div class="flex flex-col gap-2 rounded-xl p-6 frosted-glass">
<p class="text-white/80 text-base font-medium leading-normal">Overall Mastery</p>
<p class="text-white tracking-light text-3xl font-bold leading-tight" id="overall-mastery">Loading...</p>
</div>
<div class="flex flex-col gap-2 rounded-xl p-6 frosted-glass">
<p class="text-white/80 text-base font-medium leading-normal">Skills Mastered</p>
<p class="text-white tracking-light text-3xl font-bold leading-tight" id="skills-mastered">Loading...</p>
</div>
</div>
<div class="flex flex-col gap-6">
<div class="flex gap-3 flex-wrap">
<button class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white/10 px-4 hover:bg-white/20 transition-colors">
<p class="text-white text-sm font-medium leading-normal">Sort by: Mastery</p>
<span class="material-symbols-outlined text-white">expand_more</span>
</button>
<button class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white/10 px-4 hover:bg-white/20 transition-colors">
<p class="text-white text-sm font-medium leading-normal">Filter by: Topic</p>
<span class="material-symbols-outlined text-white">expand_more</span>
</button>
</div>
<div class="flex flex-col gap-6" id="mastery-items-container">
<div class="text-center py-8 text-gray-400">Loading mastery data...</div>
</div>
</div>
</main>
        </div>
    </div>
    <!-- Mobile Navigation Overlay -->
    <div id="mobile-nav-overlay" class="fixed inset-0 bg-black/80 z-50 hidden md:hidden">
        <div class="flex flex-col h-full">
            <div class="flex justify-between items-center p-6 border-b border-gray-800">
                <div class="text-xl font-bold bg-gradient-to-r from-blue-500 via-indigo-500 to-teal-500 bg-clip-text text-transparent">
                    AMEP
                </div>
                <button id="close-mobile-nav" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <nav class="flex-col p-6 space-y-6">
                <a href="student-dashboard.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Dashboard</a>
                <a href="mastery-tracker.html" class="text-white font-medium text-lg py-2 border-l-4 border-blue-500 pl-4">Mastery Tracker</a>
                <a href="assignments.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Assignments</a>
                <a href="projects.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Projects</a>
                <a href="leaderboard.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Leaderboard</a>
                <a href="badges.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Badges</a>
                <div class="border-t border-gray-800 pt-6 mt-6">
                    <a href="#" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Settings</a>
                    <a href="#" id="logout-btn" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Logout</a>
                </div>
            </nav>
        </div>
    </div>
    
    <script>
        // Mobile navigation toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const closeMobileNav = document.getElementById('close-mobile-nav');
            const mobileNavOverlay = document.getElementById('mobile-nav-overlay');
            
            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', function() {
                    mobileNavOverlay.classList.remove('hidden');
                });
            }
            
            if (closeMobileNav) {
                closeMobileNav.addEventListener('click', function() {
                    mobileNavOverlay.classList.add('hidden');
                });
            }
            
            // Close mobile menu when clicking on a link
            const mobileLinks = mobileNavOverlay.querySelectorAll('a');
            mobileLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mobileNavOverlay.classList.add('hidden');
                });
            });
        });
    </script>
    
    <script type="module">
        // Import auth service
        import { logout } from '../src/services/auth.js';
        import { studentAPI } from '../src/services/api.js';
        
        // Add logout functionality for mobile
        document.getElementById('logout-btn').addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm('Are you sure you want to logout?')) {
                logout();
            }
        });
        
        // Add logout functionality for desktop
        const desktopLogoutBtn = document.getElementById('desktop-logout-btn');
        if (desktopLogoutBtn) {
            desktopLogoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    logout();
                }
            });
        }
        
        // Update user name display
        function updateUserNameDisplay() {
            // Get user name from localStorage
            const userName = localStorage.getItem('userName') || 'Student';
            
            // Update user name in header
            const userNameElement = document.getElementById('user-name');
            if (userNameElement) {
                userNameElement.textContent = userName;
            }
            
            // Update user initials
            const userInitialsElement = document.getElementById('user-initials');
            if (userInitialsElement) {
                const names = userName.split(' ');
                let initials = '';
                if (names.length > 1) {
                    initials = names[0].charAt(0) + names[names.length - 1].charAt(0);
                } else {
                    initials = names[0].charAt(0) + names[0].charAt(1) || 'ST';
                }
                userInitialsElement.textContent = initials.toUpperCase();
            }
        }
        
        // Fetch and display mastery data
        async function fetchMasteryData() {
            try {
                // Show loading state
                showLoadingState();
                
                // Fetch real data from backend
                const masteryData = await studentAPI.getMastery();
                
                // Update the UI with real data
                updateMasteryDisplay(masteryData);
            } catch (error) {
                console.error('Error fetching mastery data:', error);
                // Fallback to showing no data
                updateMasteryDisplay([]);
            }
        }
        
        function showLoadingState() {
            // You can implement a loading state here if needed
        }
        
        function updateMasteryDisplay(masteryData) {
            // Get the container where mastery items are displayed
            const container = document.getElementById('mastery-items-container');
            
            // Clear existing content
            container.innerHTML = '';
            
            // If no data, show appropriate message
            if (!masteryData || masteryData.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-400">No mastery data available yet. Complete assignments to track your progress.</div>';
                // Update overall mastery percentage
                document.getElementById('overall-mastery').textContent = '0%';
                document.getElementById('skills-mastered').textContent = '0/0';
                return;
            }
            
            // Calculate overall mastery
            const totalScore = masteryData.reduce((sum, item) => sum + item.mastery_score, 0);
            const overallMastery = Math.round(totalScore / masteryData.length);
            
            // Update overall mastery percentage
            document.getElementById('overall-mastery').textContent = `${overallMastery}%`;
            
            // Update skills mastered count
            document.getElementById('skills-mastered').textContent = 
                `${masteryData.filter(item => item.mastery_score >= 70).length}/${masteryData.length}`;
            
            // Add each mastery item to the container
            masteryData.forEach(item => {
                // Determine proficiency level and color
                let proficiencyLevel, bgColorClass, textColorClass;
                if (item.mastery_score >= 85) {
                    proficiencyLevel = 'High Proficiency';
                    bgColorClass = 'bg-primary';
                    textColorClass = 'text-primary';
                } else if (item.mastery_score >= 70) {
                    proficiencyLevel = 'Medium Proficiency';
                    bgColorClass = 'bg-blue-medium';
                    textColorClass = 'text-blue-medium';
                } else {
                    proficiencyLevel = 'Low Proficiency';
                    bgColorClass = 'bg-indigo-low';
                    textColorClass = 'text-indigo-low';
                }
                
                // Create the HTML for this mastery item
                const masteryItemHTML = `
                    <div class="flex flex-col gap-3 rounded-xl p-6 frosted-glass">
                        <div class="flex gap-6 justify-between items-center">
                            <p class="text-white text-base font-medium leading-normal">${item.concept_name}</p>
                            <p class="text-white text-sm font-bold leading-normal">${Math.round(item.mastery_score)}%</p>
                        </div>
                        <div class="w-full rounded bg-white/10">
                            <div class="h-2 rounded ${bgColorClass}" style="width: ${item.mastery_score}%;"></div>
                        </div>
                        <p class="${textColorClass} text-sm font-medium leading-normal">${proficiencyLevel}</p>
                    </div>
                `;
                
                // Add to container
                container.insertAdjacentHTML('beforeend', masteryItemHTML);
            });
        }
        
        // Call the functions when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateUserNameDisplay();
            fetchMasteryData();
        });
    </script>
<div class="fixed bottom-8 right-8">
<button class="flex items-center gap-3 rounded-lg bg-background-dark py-3 px-6 border-2 border-primary text-primary font-bold shadow-[0_0_15px_rgba(13,242,223,0.5)] hover:bg-primary/10 transition-all">
<span class="material-symbols-outlined">model_training</span>
                Practice Weak Areas
            </button>
</div>
</div>
</body></html>