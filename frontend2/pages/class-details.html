<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Class Details - AMEP Teacher Portal</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#0db9f2",
              "background-light": "#f5f8f8",
              "background-dark": "#101e22",
            },
            fontFamily: {
              "display": ["Inter"]
            },
            borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px"},
          },
        },
      }
    </script>
<style>
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
    </style>
</head>
<body class="font-display">
<div class="relative flex h-auto min-h-screen w-full flex-col bg-background-dark dark group/design-root overflow-x-hidden">
<div class="layout-container flex h-full grow flex-col">
<div class="px-4 sm:px-8 md:px-16 lg:px-24 xl:px-40 flex flex-1 justify-center py-5">
<div class="layout-content-container flex flex-col max-w-[960px] flex-1">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-primary/20 px-4 sm:px-10 py-3">
<div class="flex items-center gap-8">
<div class="flex items-center gap-4 text-white">
<div class="size-4 text-primary">
<svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M42.4379 44C42.4379 44 36.0744 33.9038 41.1692 24C46.8624 12.9336 42.2078 4 42.2078 4L7.01134 4C7.01134 4 11.6577 12.932 5.96912 23.9969C0.876273 33.9029 7.27094 44 7.27094 44L42.4379 44Z" fill="currentColor"></path>
</svg>
</div>
<h2 class="text-white text-lg font-bold leading-tight tracking-[-0.015em]">AMEP</h2>
</div>
<div class="hidden md:flex items-center gap-9">
<a class="text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="teacher-dashboard.html">Dashboard</a>
<a class="text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="classes.html">Classes</a>
<a class="text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="student-progress.html">Students</a>
<a class="text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="interventions.html">Reports</a>
</div>
</div>
<div class="flex flex-1 justify-end gap-4 sm:gap-8">
<label class="hidden sm:flex flex-col min-w-40 !h-10 max-w-64">
<div class="flex w-full flex-1 items-stretch rounded-xl h-full">
<div class="text-[#9cb2ba] flex border-none bg-[#283539] items-center justify-center pl-4 rounded-l-xl border-r-0">
<span class="material-symbols-outlined text-2xl">search</span>
</div>
<input class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-white focus:outline-0 focus:ring-0 border-none bg-[#283539] focus:border-none h-full placeholder:text-[#9cb2ba] px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal" placeholder="Search" value=""/>
</div>
</label>
<button id="assign-content-btn" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-primary text-background-dark text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-90 transition-opacity shadow-[0_0_15px_rgba(13,185,242,0.5)]">
<span class="truncate">Assign Content</span>
</button>
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="User avatar placeholder" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuD8PZmOT22a0w5Q4nzo7eXpKfIrj2fpNLgAJzB8NL4aw8mCQcjZlhocwvUTbNacm0yrTxVNHRI0NKEAZUtJN90uv3VZNC-a35Zycyu2Y-7PeK-2iq-7Kpu7yb9k56siCp_Ia1bnHM_2tnfV1URzoMGAQNNAXA5FqBcAA_ZH4a13RnfZnlQuFs2S4tpLpVRXgZFsKFkqoqMFbRVP8k40qaoBzwMOjrCigdbR25FU8TFRjDe-k3j6MWQPiOCYPIJQlnLvZyy6ZZMKvfE");'></div>
</div>
</header>
<main class="flex-1 mt-8">
<div class="flex flex-wrap justify-between gap-3 p-4">
<div class="flex min-w-72 flex-col gap-3">
<p class="text-white text-4xl font-black leading-tight tracking-[-0.033em]" id="class-name">Loading class...</p>
<p class="text-[#9cb2ba] text-base font-normal leading-normal" id="class-description">Loading description...</p>
</div>
</div>

<!-- Class Statistics -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
<div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 bg-[#283539] border border-primary/30">
<p class="text-[#9cb2ba] text-base font-medium leading-normal">Total Students</p>
<p class="text-white tracking-light text-3xl font-bold leading-tight" id="total-students">0</p>
</div>
<div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 bg-[#283539] border border-primary/30">
<p class="text-[#9cb2ba] text-base font-medium leading-normal">Assigned Projects</p>
<p class="text-white tracking-light text-3xl font-bold leading-tight" id="assigned-projects">0</p>
</div>
<div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 bg-[#283539] border border-primary/30">
<p class="text-[#9cb2ba] text-base font-medium leading-normal">Assigned Assignments</p>
<p class="text-white tracking-light text-3xl font-bold leading-tight" id="assigned-assignments">0</p>
</div>
</div>

<!-- Students List -->
<div class="flex flex-col gap-6 mt-8">
<h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Class Students</h2>
<div class="overflow-x-auto rounded-xl border border-primary/50 bg-[#283539]">
<table class="min-w-full">
<thead>
<tr class="bg-primary/10">
<th class="px-4 py-3 text-left text-white w-[30%] text-sm font-medium leading-normal">Student Name</th>
<th class="px-4 py-3 text-left text-white w-[20%] text-sm font-medium leading-normal">ID</th>
<th class="px-4 py-3 text-left text-white w-[25%] text-sm font-medium leading-normal">Email</th>
<th class="px-4 py-3 text-left text-white w-[15%] text-sm font-medium leading-normal">Enrolled Date</th>
<th class="px-4 py-3 text-left text-[#9cb2ba] w-[10%] text-sm font-medium leading-normal">Actions</th>
</tr>
</thead>
<tbody id="students-table-body">
<tr>
<td colspan="5" class="h-[72px] px-4 py-2 text-center text-[#9cb2ba]">Loading students...</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Assigned Projects -->
<div class="flex flex-col gap-6 mt-8">
<h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Assigned Projects</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-container">
<div class="text-center py-8 text-[#9cb2ba]">Loading projects...</div>
</div>
</div>

<!-- Assigned Assignments -->
<div class="flex flex-col gap-6 mt-8">
<h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Assigned Assignments</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="assignments-container">
<div class="text-center py-8 text-[#9cb2ba]">Loading assignments...</div>
</div>
</div>
</main>
</div>
</div>
</div>
</div>

<!-- Assign Content Modal -->
<div id="assign-content-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
<div class="bg-[#283539] rounded-xl p-6 w-full max-w-2xl">
<div class="flex justify-between items-center mb-4">
<h3 class="text-white text-xl font-bold">Assign Content to Class</h3>
<button id="close-modal-btn" class="text-[#9cb2ba] hover:text-white">
<span class="material-symbols-outlined">close</span>
</button>
</div>
<div class="flex flex-col gap-4">
<div class="flex flex-col gap-2">
<label class="text-white text-sm font-medium leading-normal">Content Type</label>
<select id="content-type" class="form-select flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#9cb2ba]/30 bg-[#101e22] h-12 px-4 text-base font-normal leading-normal">
<option value="">Select content type</option>
<option value="project">Project</option>
<option value="assignment">Assignment</option>
</select>
</div>
<div class="flex flex-col gap-2">
<label class="text-white text-sm font-medium leading-normal">Content</label>
<select id="content-select" class="form-select flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#9cb2ba]/30 bg-[#101e22] h-12 px-4 text-base font-normal leading-normal">
<option value="">Select content</option>
</select>
</div>
<button id="assign-btn" class="flex min-w-[120px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-background-dark text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-90 transition-opacity mt-4">
<span class="truncate">Assign to Class</span>
</button>
</div>
</div>
</div>

<script type="module">
    // Import API service
    import { teacherAPI } from '../src/services/api.js';
    import { logout } from '../src/services/auth.js';
    
    // DOM Elements
    const assignContentBtn = document.getElementById('assign-content-btn');
    const assignContentModal = document.getElementById('assign-content-modal');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const assignBtn = document.getElementById('assign-btn');
    const contentTypeSelect = document.getElementById('content-type');
    const contentSelect = document.getElementById('content-select');
    
    // Get class ID from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const classId = parseInt(urlParams.get('class_id'));
    
    if (!classId) {
        alert('Class ID not provided');
        window.location.href = 'classes.html';
    }
    
    // Toggle assign content modal
    assignContentBtn.addEventListener('click', () => {
        assignContentModal.classList.remove('hidden');
        loadAvailableContent();
    });
    
    closeModalBtn.addEventListener('click', () => {
        assignContentModal.classList.add('hidden');
    });
    
    // Load content based on type selection
    contentTypeSelect.addEventListener('change', () => {
        loadAvailableContent();
    });
    
    // Assign content to class
    assignBtn.addEventListener('click', async () => {
        const contentType = contentTypeSelect.value;
        const contentId = parseInt(contentSelect.value);
        
        if (!contentType) {
            alert('Please select a content type');
            return;
        }
        
        if (!contentId) {
            alert('Please select content');
            return;
        }
        
        try {
            if (contentType === 'project') {
                await teacherAPI.assignProjectToClass(classId, { project_id: contentId });
            } else if (contentType === 'assignment') {
                await teacherAPI.assignAssignmentToClass(classId, { assignment_id: contentId });
            }
            
            alert('Content assigned successfully!');
            assignContentModal.classList.add('hidden');
            
            // Refresh content lists
            loadClassProjects();
            loadClassAssignments();
        } catch (error) {
            console.error('Error assigning content:', error);
            alert('Failed to assign content: ' + error.message);
        }
    });
    
    // Load class details
    async function loadClassDetails() {
        try {
            const classData = await teacherAPI.getClassById(classId);
            document.getElementById('class-name').textContent = classData.name;
            document.getElementById('class-description').textContent = classData.description || 'No description';
        } catch (error) {
            console.error('Error loading class details:', error);
            document.getElementById('class-name').textContent = 'Unknown Class';
        }
    }
    
    // Load class statistics
    async function loadClassStatistics() {
        try {
            // Load students count
            const students = await teacherAPI.getClassStudents(classId);
            document.getElementById('total-students').textContent = students.length;
            
            // Load projects count
            const projects = await teacherAPI.getClassProjects(classId);
            document.getElementById('assigned-projects').textContent = projects.length;
            
            // Load assignments count
            const assignments = await teacherAPI.getClassAssignments(classId);
            document.getElementById('assigned-assignments').textContent = assignments.length;
        } catch (error) {
            console.error('Error loading class statistics:', error);
        }
    }
    
    // Load class students
    async function loadClassStudents() {
        try {
            const students = await teacherAPI.getClassStudents(classId);
            displayStudents(students);
        } catch (error) {
            console.error('Error loading class students:', error);
            document.getElementById('students-table-body').innerHTML = '<tr><td colspan="5" class="h-[72px] px-4 py-2 text-center text-[#9cb2ba]">Failed to load students</td></tr>';
        }
    }
    
    // Display students in table
    function displayStudents(students) {
        const tbody = document.getElementById('students-table-body');
        
        if (!students || students.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="h-[72px] px-4 py-2 text-center text-[#9cb2ba]">No students enrolled in this class</td></tr>';
            return;
        }
        
        tbody.innerHTML = '';
        
        students.forEach(student => {
            const row = document.createElement('tr');
            row.className = 'border-t border-t-primary/20 hover:bg-primary/10 transition-colors';
            row.innerHTML = `
                <td class="h-[72px] px-4 py-2 text-white text-sm font-normal leading-normal">${student.name}</td>
                <td class="h-[72px] px-4 py-2 text-[#9cb2ba] text-sm font-normal leading-normal">ID-${student.id}</td>
                <td class="h-[72px] px-4 py-2 text-[#9cb2ba] text-sm font-normal leading-normal">${student.email}</td>
                <td class="h-[72px] px-4 py-2 text-white text-sm font-normal leading-normal">N/A</td>
                <td class="h-[72px] px-4 py-2 text-primary font-bold text-sm leading-normal tracking-[0.015em] cursor-pointer hover:underline">View Details</td>
            `;
            tbody.appendChild(row);
        });
    }
    
    // Load class projects
    async function loadClassProjects() {
        try {
            const projects = await teacherAPI.getClassProjects(classId);
            displayProjects(projects);
        } catch (error) {
            console.error('Error loading class projects:', error);
            document.getElementById('projects-container').innerHTML = '<div class="text-center py-8 text-[#9cb2ba]">Failed to load projects</div>';
        }
    }
    
    // Display projects
    function displayProjects(projects) {
        const container = document.getElementById('projects-container');
        
        if (!projects || projects.length === 0) {
            container.innerHTML = '<div class="text-center py-8 text-[#9cb2ba]">No projects assigned to this class</div>';
            return;
        }
        
        container.innerHTML = '';
        
        projects.forEach(project => {
            const projectCard = document.createElement('div');
            projectCard.className = 'flex flex-col gap-4 rounded-xl p-6 bg-[#283539] border border-primary/30';
            projectCard.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="flex size-12 items-center justify-center rounded-lg bg-primary/10 text-primary">
                        <span class="material-symbols-outlined text-2xl">folder</span>
                    </div>
                    <div class="flex flex-col">
                        <p class="text-white font-bold text-lg">${project.title}</p>
                        <p class="text-[#9cb2ba] text-sm">${project.description || 'No description'}</p>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-[#9cb2ba]">calendar_today</span>
                        <span class="text-[#9cb2ba] text-sm">N/A</span>
                    </div>
                    <button class="text-primary text-sm font-bold hover:underline">
                        View Details
                    </button>
                </div>
            `;
            container.appendChild(projectCard);
        });
    }
    
    // Load class assignments
    async function loadClassAssignments() {
        try {
            const assignments = await teacherAPI.getClassAssignments(classId);
            displayAssignments(assignments);
        } catch (error) {
            console.error('Error loading class assignments:', error);
            document.getElementById('assignments-container').innerHTML = '<div class="text-center py-8 text-[#9cb2ba]">Failed to load assignments</div>';
        }
    }
    
    // Display assignments
    function displayAssignments(assignments) {
        const container = document.getElementById('assignments-container');
        
        if (!assignments || assignments.length === 0) {
            container.innerHTML = '<div class="text-center py-8 text-[#9cb2ba]">No assignments assigned to this class</div>';
            return;
        }
        
        container.innerHTML = '';
        
        assignments.forEach(assignment => {
            const assignmentCard = document.createElement('div');
            assignmentCard.className = 'flex flex-col gap-4 rounded-xl p-6 bg-[#283539] border border-primary/30';
            assignmentCard.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="flex size-12 items-center justify-center rounded-lg bg-primary/10 text-primary">
                        <span class="material-symbols-outlined text-2xl">assignment</span>
                    </div>
                    <div class="flex flex-col">
                        <p class="text-white font-bold text-lg">${assignment.title}</p>
                        <p class="text-[#9cb2ba] text-sm">${assignment.description || 'No description'}</p>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-[#9cb2ba]">calendar_today</span>
                        <span class="text-[#9cb2ba] text-sm">N/A</span>
                    </div>
                    <button class="text-primary text-sm font-bold hover:underline">
                        View Details
                    </button>
                </div>
            `;
            container.appendChild(assignmentCard);
        });
    }
    
    // Load available content for assignment
    async function loadAvailableContent() {
        const contentType = contentTypeSelect.value;
        contentSelect.innerHTML = '<option value="">Select content</option>';
        
        if (!contentType) return;
        
        try {
            // Check if there's a recently created assignment/project from AI content generator
            if (contentType === 'assignment') {
                const lastAssignmentId = localStorage.getItem('lastCreatedAssignmentId');
                if (lastAssignmentId) {
                    contentSelect.innerHTML += `<option value="${lastAssignmentId}">Recently created assignment</option>`;
                }
            } else if (contentType === 'project') {
                const lastProjectId = localStorage.getItem('lastCreatedProjectId');
                if (lastProjectId) {
                    contentSelect.innerHTML += `<option value="${lastProjectId}">Recently created project</option>`;
                }
            }
            
            // Add some sample options
            for (let i = 1; i <= 5; i++) {
                contentSelect.innerHTML += `<option value="${i}">Sample ${contentType} ${i}</option>`;
            }
        } catch (error) {
            console.error('Error loading content:', error);
        }
    }
    
    // Load all data when page loads
    document.addEventListener('DOMContentLoaded', () => {
        loadClassDetails();
        loadClassStatistics();
        loadClassStudents();
        loadClassProjects();
        loadClassAssignments();
    });
</script>
</body>
</html>