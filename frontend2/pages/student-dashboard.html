<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMEP - Student Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="min-h-screen bg-[#0B1120] text-white">
    <!-- Include Header Component -->
    <div id="header-container">
        <!-- Header will be loaded here -->
    </div>
    
    <!-- Include Mobile Navigation -->
    <div id="mobile-nav-container">
        <!-- Mobile nav will be loaded here -->
    </div>
    
    <!-- Main Content -->
    <div class="min-h-screen bg-[#0B1120] text-white">
        <!-- Include Breadcrumb -->
        <div id="breadcrumb-container" class="container mx-auto px-6 py-4">
            <!-- Breadcrumb will be loaded here -->
        </div>
        
        <!-- Header -->
        <header class="border-b border-indigo-500/20 backdrop-blur-sm bg-[#0F172A]/30">
            <div class="container mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="text-xl font-bold tracking-wide bg-gradient-to-r from-blue-500 via-indigo-500 to-teal-500 bg-clip-text text-transparent">
                        AMEP
                    </div>
                    <nav class="hidden md:flex space-x-6">
                        <a href="student-dashboard.html" class="text-white font-medium nav-link" data-page="dashboard">Dashboard</a>
                        <a href="mastery-tracker.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="mastery">Mastery Tracker</a>
                        <a href="assignments.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="assignments">Assignments</a>
                        <a href="projects.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="projects">Projects</a>
                        <a href="leaderboard.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="leaderboard">Leaderboard</a>
                        <a href="badges.html" class="text-gray-300 hover:text-white transition-colors nav-link" data-page="badges">Badges</a>
                    </nav>
                    <div class="flex items-center space-x-4">
                        <button id="mobile-menu-toggle" class="md:hidden text-gray-400 hover:text-white focus:outline-none">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                        <span class="text-gray-300 hidden sm:inline" id="user-name">John Doe</span>
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center">
                            <span class="font-bold" id="user-initials">JD</span>
                        </div>
                        <a href="#" id="desktop-logout-btn" class="hidden md:block text-gray-300 hover:text-white transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </header>
        <!-- Main Content -->
        <main class="container mx-auto px-6 py-12">
            <div class="mb-10">
                <h1 class="text-3xl font-bold mb-2">Student Dashboard</h1>
                <p class="text-gray-400">Welcome back, <span id="welcome-name">John</span>! Here's your learning progress.</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
                <div class="bg-[#0F172A]/50 rounded-2xl border border-indigo-500/30 backdrop-blur-lg p-6 hover:border-indigo-500/50 transition-all">
                    <div class="text-3xl font-bold text-blue-400 mb-2" id="active-courses">Loading...</div>
                    <div class="text-gray-400">Active Courses</div>
                </div>
                <div class="bg-[#0F172A]/50 rounded-2xl border border-indigo-500/30 backdrop-blur-lg p-6 hover:border-indigo-500/50 transition-all">
                    <div class="text-3xl font-bold text-green-400 mb-2" id="completed-modules">Loading...</div>
                    <div class="text-gray-400">Completed Modules</div>
                </div>
                <div class="bg-[#0F172A]/50 rounded-2xl border border-indigo-500/30 backdrop-blur-lg p-6 hover:border-indigo-500/50 transition-all">
                    <div class="text-3xl font-bold text-yellow-400 mb-2" id="badges-earned">Loading...</div>
                    <div class="text-gray-400">Badges Earned</div>
                </div>
                <div class="bg-[#0F172A]/50 rounded-2xl border border-indigo-500/30 backdrop-blur-lg p-6 hover:border-indigo-500/50 transition-all">
                    <div class="text-3xl font-bold text-purple-400 mb-2" id="overall-progress">Loading...</div>
                    <div class="text-gray-400">Overall Progress</div>
                </div>
            </div>

            <!-- Progress Overview -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <!-- Mastery Tracker -->
                <div class="bg-[#0F172A]/50 rounded-2xl border border-indigo-500/30 backdrop-blur-lg p-6">
                    <h2 class="text-xl font-bold mb-6">Subject Mastery</h2>
                    <div class="space-y-6" id="subject-mastery-container">
                        <div class="text-center py-4 text-gray-400">Loading subject mastery data...</div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-[#0F172A]/50 rounded-2xl border border-indigo-500/30 backdrop-blur-lg p-6">
                    <h2 class="text-xl font-bold mb-6">Recent Activity</h2>
                    <div class="space-y-4" id="recent-activity-container">
                        <div class="text-center py-4 text-gray-400">Loading recent activity...</div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Assignments -->
            <div class="bg-[#0F172A]/50 rounded-2xl border border-indigo-500/30 backdrop-blur-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Upcoming Assignments & Projects</h2>
                    <a href="assignments.html" class="text-blue-400 hover:text-blue-300 text-sm">View All</a>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="upcoming-content-container">
                    <div class="text-center py-4 text-gray-400">Loading upcoming content...</div>
                </div>
            </div>
        </main>
        
        <!-- API Integration -->
        <script type="module">
            // Import API service
            import { studentAPI } from '../src/services/api.js';
            import { logout } from '../src/services/auth.js';
            
            // Add logout functionality for mobile
            document.getElementById('logout-btn').addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    logout();
                }
            });
            
            // Add logout functionality for desktop
            const desktopLogoutBtn = document.getElementById('desktop-logout-btn');
            if (desktopLogoutBtn) {
                desktopLogoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('Are you sure you want to logout?')) {
                        logout();
                    }
                });
            }
            
            // Update user name display
            function updateUserNameDisplay() {
                // Get user name from localStorage
                const userName = localStorage.getItem('userName') || 'Student';
                
                // Update user name in header
                const userNameElement = document.getElementById('user-name');
                if (userNameElement) {
                    userNameElement.textContent = userName;
                }
                
                // Update welcome message
                const welcomeNameElement = document.getElementById('welcome-name');
                if (welcomeNameElement) {
                    welcomeNameElement.textContent = userName.split(' ')[0] || userName;
                }
                
                // Update user initials
                const userInitialsElement = document.getElementById('user-initials');
                if (userInitialsElement) {
                    const names = userName.split(' ');
                    let initials = '';
                    if (names.length > 1) {
                        initials = names[0].charAt(0) + names[names.length - 1].charAt(0);
                    } else {
                        initials = names[0].charAt(0) + names[0].charAt(1) || 'ST';
                    }
                    userInitialsElement.textContent = initials.toUpperCase();
                }
            }
            
            async function fetchStudentStats() {
                try {
                    // Show loading state
                    showLoadingState();
                    
                    // Get student ID from localStorage (assuming it's stored during login)
                    const studentId = parseInt(localStorage.getItem('studentId')) || 1;
                    
                    // Fetch real data from backend
                    const masteryData = await studentAPI.getMastery();
                    const assignmentsData = await studentAPI.getAssignments(studentId);
                    const badgesData = await studentAPI.getBadges(studentId);
                    const projectsData = await studentAPI.getProjects(studentId);
                    
                    // Combine assignments and projects
                    const upcomingContent = [...assignmentsData, ...projectsData];
                    
                    // Calculate stats based on real data
                    const statsData = {
                        activeCourses: masteryData.length,
                        completedModules: assignmentsData.filter(a => a.status === 'completed').length,
                        badgesEarned: badgesData.length,
                        overallProgress: calculateOverallProgress(masteryData),
                        masteryData: masteryData,
                        recentActivity: [], // We'll need to implement this
                        upcomingContent: upcomingContent.slice(0, 3)
                    };
                    
                    updateStatsDisplay(statsData);
                    updateMasteryDisplay(statsData.masteryData);
                    updateActivityDisplay(statsData.recentActivity);
                    updateContentDisplay(statsData.upcomingContent);
                } catch (error) {
                    console.error('Error fetching student stats:', error);
                    // Fallback to showing no data
                    const emptyData = {
                        activeCourses: 0,
                        completedModules: 0,
                        badgesEarned: 0,
                        overallProgress: 0,
                        masteryData: [],
                        recentActivity: [],
                        upcomingContent: []
                    };
                    updateStatsDisplay(emptyData);
                    updateMasteryDisplay([]);
                    updateActivityDisplay([]);
                    updateContentDisplay([]);
                }
            }
            
            function calculateOverallProgress(masteryData) {
                if (!masteryData.length) return 0;
                const totalScore = masteryData.reduce((sum, item) => sum + item.mastery_score, 0);
                return Math.round(totalScore / masteryData.length);
            }
            
            function showLoadingState() {
                // Stats cards
                document.getElementById('active-courses').textContent = 'Loading...';
                document.getElementById('completed-modules').textContent = 'Loading...';
                document.getElementById('badges-earned').textContent = 'Loading...';
                document.getElementById('overall-progress').textContent = 'Loading...';
                
                // Containers
                document.getElementById('subject-mastery-container').innerHTML = '<div class="text-center py-4 text-gray-400">Loading subject mastery data...</div>';
                document.getElementById('recent-activity-container').innerHTML = '<div class="text-center py-4 text-gray-400">Loading recent activity...</div>';
                document.getElementById('upcoming-assignments-container').innerHTML = '<div class="text-center py-4 text-gray-400">Loading upcoming assignments...</div>';
            }
            
            function updateStatsDisplay(data) {
                // Update the stats cards with fetched data
                document.getElementById('active-courses').textContent = data.activeCourses;
                document.getElementById('completed-modules').textContent = data.completedModules;
                document.getElementById('badges-earned').textContent = data.badgesEarned;
                document.getElementById('overall-progress').textContent = data.overallProgress + '%';
            }
            
            function updateMasteryDisplay(masteryData) {
                const container = document.getElementById('subject-mastery-container');
                
                // Clear existing content
                container.innerHTML = '';
                
                // If no data, show appropriate message
                if (!masteryData || masteryData.length === 0) {
                    container.innerHTML = '<div class="text-center py-4 text-gray-400">No mastery data available yet. Complete assignments to track your progress.</div>';
                    return;
                }
                
                // Add each mastery item to the container
                masteryData.forEach(item => {
                    // Determine color based on mastery score
                    let bgColorClass;
                    if (item.mastery_score >= 85) {
                        bgColorClass = 'from-blue-500 to-indigo-500';
                    } else if (item.mastery_score >= 70) {
                        bgColorClass = 'from-indigo-500 to-teal-500';
                    } else if (item.mastery_score >= 50) {
                        bgColorClass = 'from-teal-500 to-blue-500';
                    } else {
                        bgColorClass = 'from-purple-500 to-pink-500';
                    }
                    
                    // Create the HTML for this mastery item
                    const masteryItemHTML = `
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-300">${item.concept_name}</span>
                                <span class="text-gray-400">${Math.round(item.mastery_score)}%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2.5">
                                <div class="bg-gradient-to-r ${bgColorClass} h-2.5 rounded-full" style="width: ${item.mastery_score}%"></div>
                            </div>
                        </div>
                    `;
                    
                    // Add to container
                    container.insertAdjacentHTML('beforeend', masteryItemHTML);
                });
            }
            
            function updateActivityDisplay(activityData) {
                const container = document.getElementById('recent-activity-container');
                
                // Clear existing content
                container.innerHTML = '';
                
                // If no data, show appropriate message
                if (!activityData || activityData.length === 0) {
                    container.innerHTML = '<div class="text-center py-4 text-gray-400">No recent activity. Complete assignments to see your activity history.</div>';
                    return;
                }
                
                // For now, we'll show a message that this feature will be implemented
                container.innerHTML = '<div class="text-center py-4 text-gray-400">Recent activity tracking will be implemented soon.</div>';
            }
            
            function updateContentDisplay(contentData) {
                const container = document.getElementById('upcoming-content-container');
                
                // Clear existing content
                container.innerHTML = '';
                
                // If no data, show appropriate message
                if (!contentData || contentData.length === 0) {
                    container.innerHTML = '<div class="text-center py-4 text-gray-400 col-span-3">No upcoming assignments or projects. Check with your teacher for new content.</div>';
                    return;
                }
                
                // Add each content item to the container
                contentData.forEach(item => {
                    // Determine if it's an assignment or project based on available properties
                    const isProject = item.hasOwnProperty('start_date') || item.hasOwnProperty('end_date');
                    
                    if (isProject) {
                        // Create the HTML for this project
                        const projectHTML = `
                            <div class="border border-gray-700/50 rounded-xl p-4 hover:border-indigo-500/50 transition-all">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-medium">${item.title}</h3>
                                    <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded-full">Project</span>
                                </div>
                                <div class="text-gray-400 text-sm mb-3">${item.description || 'Project'}</div>
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>Project</span>
                                    <span>Assigned</span>
                                </div>
                            </div>
                        `;
                        
                        // Add to container
                        container.insertAdjacentHTML('beforeend', projectHTML);
                    } else {
                        // Create the HTML for this assignment
                        const assignmentHTML = `
                            <div class="border border-gray-700/50 rounded-xl p-4 hover:border-indigo-500/50 transition-all">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-medium">${item.title}</h3>
                                    <span class="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded-full">Assignment</span>
                                </div>
                                <div class="text-gray-400 text-sm mb-3">${item.description || 'Assignment'}</div>
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>${item.points || 0} points</span>
                                    <span>${item.problem_count || 0} problems</span>
                                </div>
                            </div>
                        `;
                        
                        // Add to container
                        container.insertAdjacentHTML('beforeend', assignmentHTML);
                    }
                });
            }
            
            // Call the functions when page loads
            document.addEventListener('DOMContentLoaded', function() {
                updateUserNameDisplay();
                fetchStudentStats();
            });
        </script>
        
        <!-- Footer -->        <footer class="bg-[#0F172A] border-t border-indigo-500/20 mt-12">
            <div class="container mx-auto px-6 py-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <h3 class="text-xl font-bold bg-gradient-to-r from-blue-500 via-indigo-500 to-teal-500 bg-clip-text text-transparent mb-4">AMEP</h3>
                        <p class="text-gray-400 text-sm">Empowering minds through futuristic education.</p>
                    </div>
                    <div>
                        <h4 class="text-white font-semibold mb-4">For Students</h4>
                        <ul class="space-y-2">
                            <li><a href="student-dashboard.html" class="text-gray-400 hover:text-white text-sm transition-colors">Dashboard</a></li>
                            <li><a href="assignments.html" class="text-gray-400 hover:text-white text-sm transition-colors">Assignments</a></li>
                            <li><a href="submit-assignment.html" class="text-gray-400 hover:text-white text-sm transition-colors">Submit Assignment</a></li>
                            <li><a href="projects.html" class="text-gray-400 hover:text-white text-sm transition-colors">Projects</a></li>
                            <li><a href="badges.html" class="text-gray-400 hover:text-white text-sm transition-colors">Badges</a></li>
                            <li><a href="log-engagement.html" class="text-gray-400 hover:text-white text-sm transition-colors">Log Engagement</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="text-white font-semibold mb-4">For Teachers</h4>
                        <ul class="space-y-2">
                            <li><a href="teacher-dashboard.html" class="text-gray-400 hover:text-white text-sm transition-colors">Dashboard</a></li>
                            <li><a href="ai-content-generator.html" class="text-gray-400 hover:text-white text-sm transition-colors">AI Content</a></li>
                            <li><a href="classes.html" class="text-gray-400 hover:text-white text-sm transition-colors">Classes</a></li>
                            <li><a href="analytics.html" class="text-gray-400 hover:text-white text-sm transition-colors">Analytics</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="text-white font-semibold mb-4">Company</h4>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-400 hover:text-white text-sm transition-colors">About</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white text-sm transition-colors">Contact</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white text-sm transition-colors">Privacy Policy</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white text-sm transition-colors">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="border-t border-gray-800 mt-8 pt-6 text-center">
                    <p class="text-gray-500 text-sm">Â© 2025 AMEP. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Mobile Navigation Overlay -->
    <div id="mobile-nav-overlay" class="fixed inset-0 bg-black/80 z-50 hidden md:hidden">
        <div class="flex flex-col h-full">
            <div class="flex justify-between items-center p-6 border-b border-gray-800">
                <div class="text-xl font-bold bg-gradient-to-r from-blue-500 via-indigo-500 to-teal-500 bg-clip-text text-transparent">
                    AMEP
                </div>
                <button id="close-mobile-nav" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <nav class="flex-col p-6 space-y-6">
                <a href="student-dashboard.html" class="text-white font-medium text-lg py-2 border-l-4 border-blue-500 pl-4">Dashboard</a>
                <a href="mastery-tracker.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Mastery Tracker</a>
                <a href="assignments.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Assignments</a>
                <a href="projects.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Projects</a>
                <a href="leaderboard.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Leaderboard</a>
                <a href="badges.html" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Badges</a>
                <div class="border-t border-gray-800 pt-6 mt-6">
                    <a href="#" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Settings</a>
                    <a href="#" id="logout-btn" class="text-gray-400 hover:text-white text-lg py-2 transition-colors">Logout</a>
                </div>
            </nav>
        </div>
    </div>
    
    <script>
        // Mobile navigation toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const closeMobileNav = document.getElementById('close-mobile-nav');
            const mobileNavOverlay = document.getElementById('mobile-nav-overlay');
            
            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', function() {
                    mobileNavOverlay.classList.remove('hidden');
                });
            }
            
            if (closeMobileNav) {
                closeMobileNav.addEventListener('click', function() {
                    mobileNavOverlay.classList.add('hidden');
                });
            }
            
            // Close mobile menu when clicking on a link
            const mobileLinks = mobileNavOverlay.querySelectorAll('a');
            mobileLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mobileNavOverlay.classList.add('hidden');
                });
            });
            
            // Highlight active nav link
            function highlightActiveNavLink() {
                const currentPage = window.location.pathname.split('/').pop();
                const navLinks = document.querySelectorAll('.nav-link');
                
                navLinks.forEach(link => {
                    link.classList.remove('text-white', 'font-medium');
                    link.classList.add('text-gray-300');
                    
                    // Map pages to their respective nav items
                    const pageMap = {
                        'student-dashboard.html': 'dashboard',
                        'mastery-tracker.html': 'mastery',
                        'assignments.html': 'assignments',
                        'assignment-details.html': 'assignments',
                        'projects.html': 'projects',
                        'project-details.html': 'projects',
                        'leaderboard.html': 'leaderboard',
                        'badges.html': 'badges'
                    };
                    
                    const pageKey = pageMap[currentPage];
                    if (link.getAttribute('data-page') === pageKey) {
                        link.classList.remove('text-gray-300');
                        link.classList.add('text-white', 'font-medium');
                    }
                });
            }
            
            // Call on page load
            highlightActiveNavLink();
        });
    </script>
</body>
</html>