<!DOCTYPE html>

<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>AMEP Teacher Dashboard</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .glowing-icon {
            text-shadow: 0 0 8px rgba(13, 185, 242, 0.4);
        }
        .active-link .glowing-icon {
            text-shadow: 0 0 12px rgba(13, 185, 242, 0.8);
        }
    </style>
<script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#0db9f2",
              "background-light": "#f5f8f8",
              "background-dark": "#101e22",
            },
            fontFamily: {
              "display": ["Inter", "sans-serif"]
            },
            borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px"},
          },
        },
      }
    </script>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-white">
<div class="flex min-h-screen">
<!-- SideNavBar -->
<div class="fixed top-0 left-0 flex h-full w-64 flex-col bg-[#111618] p-4 border-r border-slate-800">
<div class="flex items-center gap-3 px-3 py-4 text-primary">
<div class="size-8">
<svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M44 11.2727C44 14.0109 39.8386 16.3957 33.69 17.6364C39.8386 18.877 44 21.2618 44 24C44 26.7382 39.8386 29.123 33.69 30.3636C39.8386 31.6043 44 33.9891 44 36.7273C44 40.7439 35.0457 44 24 44C12.9543 44 4 40.7439 4 36.7273C4 33.9891 8.16144 31.6043 14.31 30.3636C8.16144 29.123 4 26.7382 4 24C4 21.2618 8.16144 18.877 14.31 17.6364C8.16144 16.3957 4 14.0109 4 11.2727C4 7.25611 12.9543 4 24 4C35.0457 4 44 7.25611 44 11.2727Z" fill="currentColor"></path>
</svg>
</div>
<h2 class="text-lg font-bold tracking-[-0.015em]">AMEP Teacher Portal</h2>
</div>
<div class="flex flex-col gap-4 mt-6">
<div class="flex flex-col gap-2">
<div class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/20 text-primary active-link">
<span class="material-symbols-outlined glowing-icon" style="font-variation-settings: 'FILL' 1, 'wght' 400;">dashboard</span>
<p class="text-sm font-medium leading-normal">Dashboard</p>
</div>
<div class="flex items-center gap-3 px-3 py-2 text-slate-300 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors">
<a href="student-progress.html" class="flex items-center gap-3 w-full h-full">
<span class="material-symbols-outlined">group</span>
<p class="text-sm font-medium leading-normal">Students</p>
</a>
</div>
<div class="flex items-center gap-3 px-3 py-2 text-slate-300 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors">
<a href="classes.html" class="flex items-center gap-3 w-full h-full">
<span class="material-symbols-outlined">school</span>
<p class="text-sm font-medium leading-normal">Classes</p>
</a>
</div>
<div class="flex items-center gap-3 px-3 py-2 text-slate-300 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors">
<a href="ai-content-generator.html" class="flex items-center gap-3 w-full h-full">
<span class="material-symbols-outlined">assignment</span>
<p class="text-sm font-medium leading-normal">Assignments</p>
</a>
</div>
<div class="flex items-center gap-3 px-3 py-2 text-slate-300 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors">
<span class="material-symbols-outlined">calendar_today</span>
<p class="text-sm font-medium leading-normal">Calendar</p>
</div>
<div class="flex items-center gap-3 px-3 py-2 text-slate-300 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors">
<a href="interventions.html" class="flex items-center gap-3 w-full h-full">
<span class="material-symbols-outlined">analytics</span>
<p class="text-sm font-medium leading-normal">Reports</p>
</a>
</div>
</div>
</div>
<div class="mt-auto flex flex-col gap-2">
<div class="flex items-center gap-3 px-3 py-2 text-slate-300 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors">
<span class="material-symbols-outlined">settings</span>
<p class="text-sm font-medium leading-normal">Settings</p>
</div>
<div class="flex items-center gap-3 px-3 py-2 text-slate-300 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors cursor-pointer" id="logout-btn">
<span class="material-symbols-outlined">logout</span>
<p class="text-sm font-medium leading-normal">Logout</p>
</div>
<div class="border-t border-slate-800 my-2"></div>
<div class="flex gap-3 p-2">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Profile picture of Teacher" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBHxyIUfnbRbr9Y3Ar3v6g4DycqHkxAJSb8iQF3pAra0jXRnvJlqhLD4oYIZPVgW1zn_WEVVwOqvj0mK75k99OX7BogsxC8dbiydCzbfLUeHMngFWPwsH7Sa8e3_lqyzZJ1OLvqD4VfjpDS-t0P9llyyLB0iiQY9uynsmba7JXWQ3eIrYElv4aHk7nxPXic0Om2qMmNo3asBS65TbG_GOBDsmWqXAMaXAd_5UJmy_Lnu9HS6jen7_tqlNIrAQDChJqsGV8rfpEdUPg");'></div>
<div class="flex flex-col">
<h1 class="text-white text-base font-medium leading-normal" id="teacher-name">Dr. Anya Sharma</h1>
<p class="text-slate-400 text-sm font-normal leading-normal" id="teacher-email">teacher@school.edu</p>
</div>
</div>
</div>
</div>
<!-- Main Content -->
<div class="ml-64 flex-1">
<!-- TopNavBar -->
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-slate-800 px-10 py-4 sticky top-0 bg-background-dark/80 backdrop-blur-sm z-10">
<label class="flex flex-col min-w-40 !h-10 w-full max-w-sm">
<div class="flex w-full flex-1 items-stretch rounded-lg h-full">
<div class="text-slate-400 flex border-none bg-[#111618] items-center justify-center pl-4 rounded-l-lg border-r-0">
<span class="material-symbols-outlined">search</span>
</div>
<input class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border-none bg-[#111618] h-full placeholder:text-slate-400 px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal" placeholder="Search students, classes, assignments..." value=""/>
</div>
</label>
<div class="flex items-center justify-end gap-4">
<a href="ai-content-generator.html" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-background-dark text-sm font-bold leading-normal tracking-[0.015em] hover:bg-primary/90 transition-colors">
<span class="truncate">AI Content Generator</span>
</a>
<button class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 bg-[#111618] text-slate-300 gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5 hover:text-primary transition-colors">
<span class="material-symbols-outlined">notifications</span>
</button>
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Profile picture of Dr. Anya Sharma" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDne_mBmZNL4SCmH9U_BsrsKAXywK2ZW7XopHhU3anJZ0haK0kNKdYSYd2Zz5fg2ui1CX8qhNYIEMNl6P712w_pQ-REldaYuZ8MRsYmJ00KrsAO0-RxMHl_hfe3ClEdQouhQz0LawstnKX2DtcKpp9RaOZo30DRUn_VYXxzxbHyX_tAq5W_3LX4JutrXTMcqbb1L-5nJYkFeJ9_LuJ23kIhPz1QAoCg0e6nEqiSkXiy0oarHhLUmsYwiTNAfwxLkzyZF4tV9OBIgKs");'></div>
</div>
</header>
<main class="p-10">
<!-- PageHeading -->
<div class="flex flex-wrap justify-between gap-3 mb-6">
<div class="flex min-w-72 flex-col gap-2">
<p class="text-white text-4xl font-black leading-tight tracking-[-0.033em]">Welcome Back, <span id="welcome-teacher-name">Dr. Sharma</span>!</p>
<p class="text-slate-400 text-base font-normal leading-normal">Here's a snapshot of your classes today.</p>
</div>
</div>
<!-- Stats -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
<div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 bg-[#111618] border border-slate-800">
<p class="text-slate-300 text-base font-medium leading-normal">Active Students</p>
<p class="text-white tracking-light text-3xl font-bold leading-tight" id="active-students">Loading...</p>
<p class="text-green-400 text-sm font-medium leading-normal" id="students-change">Loading...</p>
</div>
<div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 bg-[#111618] border border-slate-800">
<p class="text-slate-300 text-base font-medium leading-normal">Average Grade</p>
<p class="text-white tracking-light text-3xl font-bold leading-tight" id="average-grade">Loading...</p>
<p class="text-green-400 text-sm font-medium leading-normal" id="grade-change">Loading...</p>
</div>
<div class="flex min-w-[158px] flex-1 flex-col gap-2 rounded-xl p-6 bg-[#111618] border border-slate-800">
<p class="text-slate-300 text-base font-medium leading-normal">Attendance Rate</p>
<p class="text-white tracking-light text-3xl font-bold leading-tight" id="attendance-rate">Loading...</p>
<p class="text-red-400 text-sm font-medium leading-normal" id="attendance-change">Loading...</p>
</div>
</div>
<div class="grid grid-cols-3 gap-6">
<!-- Main column -->
<div class="col-span-3 lg:col-span-2 flex flex-col gap-6">
<!-- SectionHeader -->
<h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">At-Risk Students</h2>
<!-- At-Risk Student Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6" id="at-risk-students-container">
<div class="text-center py-4 text-slate-400">Loading at-risk students data...</div>
</div>
<!-- Class Performance Chart -->
<div class="flex flex-col gap-4 rounded-xl p-6 bg-[#111618] border border-slate-800 mt-4">
<h3 class="text-white text-lg font-bold">Class Performance Overview</h3>
<p class="text-slate-400 text-sm">Average grade trend for the last 6 months.</p>
<div class="w-full h-64 flex items-center justify-center" id="performance-chart-container">
<!-- Placeholder for chart -->
<div class="text-center py-4 text-slate-400">Performance data will be displayed here.</div>
</div>
</div>
</div>
<!-- Sidebar column -->
<div class="col-span-3 lg:col-span-1 flex flex-col gap-6">
<h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Upcoming Deadlines</h2>
<div class="flex flex-col gap-4 rounded-xl p-4 bg-[#111618] border border-slate-800" id="upcoming-deadlines-container">
<div class="text-center py-4 text-slate-400">Loading upcoming deadlines...</div>
</div>
</div>
</div>
</main>
</div>
</div>

<script type="module">
    // Import auth service
    import { logout } from '../src/services/auth.js';
    import { teacherAPI } from '../src/services/api.js';
    
    // Add logout functionality
    document.getElementById('logout-btn').addEventListener('click', function() {
        if (confirm('Are you sure you want to logout?')) {
            logout();
        }
    });
    
    // Fetch and display teacher dashboard data
    async function fetchTeacherDashboard() {
        try {
            // Show loading states
            showLoadingStates();
            
            // Get teacher ID from localStorage (assuming it's stored during login)
            const teacherId = parseInt(localStorage.getItem('teacherId')) || 1;
            
            // Fetch real data from backend
            const dashboardData = await teacherAPI.getDashboard(teacherId);
            
            // Update the UI with real data
            updateDashboardDisplay(dashboardData);
        } catch (error) {
            console.error('Error fetching teacher dashboard data:', error);
            // Fallback to showing no data
            updateDashboardDisplay({
                class_mastery_summary: {},
                engagement_metrics: {
                    active_students: 0,
                    avg_daily_engagement: 0.0,
                    high_confusion_cases: 0
                },
                soft_skill_summary: {},
                leaderboard: [],
                struggling_students: []
            });
        }
    }
    
    function showLoadingStates() {
        // Stats
        document.getElementById('active-students').textContent = 'Loading...';
        document.getElementById('students-change').textContent = 'Loading...';
        document.getElementById('average-grade').textContent = 'Loading...';
        document.getElementById('grade-change').textContent = 'Loading...';
        document.getElementById('attendance-rate').textContent = 'Loading...';
        document.getElementById('attendance-change').textContent = 'Loading...';
        
        // Containers
        document.getElementById('at-risk-students-container').innerHTML = '<div class="text-center py-4 text-slate-400">Loading at-risk students data...</div>';
        document.getElementById('performance-chart-container').innerHTML = '<div class="text-center py-4 text-slate-400">Loading performance data...</div>';
        document.getElementById('upcoming-deadlines-container').innerHTML = '<div class="text-center py-4 text-slate-400">Loading upcoming deadlines...</div>';
    }
    
    function updateDashboardDisplay(dashboardData) {
        // Update stats
        document.getElementById('active-students').textContent = dashboardData.engagement_metrics.active_students;
        document.getElementById('students-change').textContent = '+0 this month';
        document.getElementById('average-grade').textContent = dashboardData.class_mastery_summary ? 
            (Object.keys(dashboardData.class_mastery_summary).length > 0 ? 
                Math.round(Object.values(dashboardData.class_mastery_summary)[0].average) + '%' : '0%') : '0%';
        document.getElementById('grade-change').textContent = '+0% from last week';
        document.getElementById('attendance-rate').textContent = '0%';
        document.getElementById('attendance-change').textContent = '+0% from last week';
        
        // Update at-risk students
        updateAtRiskStudents(dashboardData.struggling_students);
        
        // Update performance chart (placeholder)
        updatePerformanceChart(dashboardData.class_mastery_summary);
        
        // Update upcoming deadlines (placeholder)
        updateUpcomingDeadlines();
    }
    
    function updateAtRiskStudents(strugglingStudents) {
        const container = document.getElementById('at-risk-students-container');
        
        // Clear existing content
        container.innerHTML = '';
        
        // If no data, show appropriate message
        if (!strugglingStudents || strugglingStudents.length === 0) {
            container.innerHTML = '<div class="text-center py-4 text-slate-400 col-span-3">No at-risk students identified. Continue monitoring your class performance.</div>';
            return;
        }
        
        // For now, show a message that this feature will be implemented
        container.innerHTML = '<div class="text-center py-4 text-slate-400 col-span-3">At-risk student identification will be implemented soon.</div>';
    }
    
    function updatePerformanceChart(classMasterySummary) {
        const container = document.getElementById('performance-chart-container');
        
        // Clear existing content
        container.innerHTML = '';
        
        // If no data, show appropriate message
        if (!classMasterySummary || Object.keys(classMasterySummary).length === 0) {
            container.innerHTML = '<div class="text-center py-4 text-slate-400">No performance data available yet. Student activity will appear here.</div>';
            return;
        }
        
        // For now, show a message that this feature will be implemented
        container.innerHTML = '<div class="text-center py-4 text-slate-400">Class performance visualization will be implemented soon.</div>';
    }
    
    function updateUpcomingDeadlines() {
        const container = document.getElementById('upcoming-deadlines-container');
        
        // Clear existing content
        container.innerHTML = '';
        
        // Show appropriate message
        container.innerHTML = '<div class="text-center py-4 text-slate-400">Upcoming deadlines will be implemented soon.</div>';
    }
</script>

<script>
    // Update teacher name display
    document.addEventListener('DOMContentLoaded', function() {
        updateTeacherNameDisplay();
        fetchTeacherDashboard();
    });
    
    function updateTeacherNameDisplay() {
        // Get user name from localStorage
        const userName = localStorage.getItem('userName') || 'Teacher';
        
        // Update teacher name in profile section
        const teacherNameElement = document.getElementById('teacher-name');
        if (teacherNameElement) {
            teacherNameElement.textContent = userName;
        }
        
        // Update welcome message
        const welcomeTeacherNameElement = document.getElementById('welcome-teacher-name');
        if (welcomeTeacherNameElement) {
            welcomeTeacherNameElement.textContent = userName.split(' ')[0] || userName;
        }
        
        // Update email (using a simple approach for demo)
        const teacherEmailElement = document.getElementById('teacher-email');
        if (teacherEmailElement) {
            // Extract name part and create a simple email
            const namePart = userName.toLowerCase().replace(/\s+/g, '.');
            teacherEmailElement.textContent = namePart + '@school.edu';
        }
    }
</script>
</body></html>